# 用户操作指南 - 清除浏览器缓存

## 问题已修复 ✅

后端和前端都已更新并重新部署。现在需要**清除浏览器缓存**以加载最新的前端代码。

---

## 立即执行的操作

### 方法1: 硬刷新页面（推荐）

#### Windows/Linux
1. 打开网站: `http://YOUR_SERVER_IP:28888`
2. 按下组合键: **`Ctrl + Shift + R`** 或 **`Ctrl + F5`**
3. 等待页面完全重新加载

#### Mac
1. 打开网站: `http://YOUR_SERVER_IP:28888`
2. 按下组合键: **`Cmd + Shift + R`**
3. 等待页面完全重新加载

---

### 方法2: 清除浏览器缓存（彻底）

#### Chrome / Edge
1. 按 **`Ctrl + Shift + Delete`** (Mac: `Cmd + Shift + Delete`)
2. 在弹出窗口中：
   - 时间范围: 选择 **"全部时间"**
   - 勾选: **"缓存的图片和文件"**
   - 勾选: **"Cookie 及其他网站数据"** (可选)
3. 点击 **"清除数据"**
4. 刷新页面

#### Firefox
1. 按 **`Ctrl + Shift + Delete`** (Mac: `Cmd + Shift + Delete`)
2. 在弹出窗口中：
   - 时间范围: 选择 **"全部"**
   - 勾选: **"缓存"**
3. 点击 **"立即清除"**
4. 刷新页面

#### Safari (Mac)
1. 菜单栏 → **Safari** → **偏好设置**
2. 点击 **"高级"** 标签
3. 勾选 **"在菜单栏中显示开发菜单"**
4. 菜单栏 → **开发** → **清空缓存**
5. 刷新页面

---

### 方法3: 使用隐私模式测试（快速验证）

#### Chrome / Edge
- 按 **`Ctrl + Shift + N`** (Mac: `Cmd + Shift + N`)
- 在隐私窗口中访问: `http://YOUR_SERVER_IP:28888`

#### Firefox
- 按 **`Ctrl + Shift + P`** (Mac: `Cmd + Shift + P`)
- 在隐私窗口中访问: `http://YOUR_SERVER_IP:28888`

#### Safari
- 按 **`Cmd + Shift + N`**
- 在隐私窗口中访问: `http://YOUR_SERVER_IP:28888`

---

## 验证修复是否成功

### 1. 打开开发者工具
- 按 **`F12`** 或 **`Ctrl + Shift + I`** (Mac: `Cmd + Option + I`)

### 2. 切换到 Network 标签
- 点击顶部的 **"Network"** 或 **"网络"** 标签

### 3. 勾选 "Disable cache"
- 在 Network 标签中，勾选 **"Disable cache"** 或 **"禁用缓存"**

### 4. 刷新页面
- 按 **`F5`** 或点击刷新按钮

### 5. 测试生成功能
1. 在输入框中输入: `我想生成一个微笑的站姿角色，穿着红色上衣，拿着气球 ip形象`
2. 点击发送
3. 观察是否出现以下情况：

#### ✅ 修复成功的表现
- 显示 **"正在生成..."** 或进度提示
- **不会立即显示** "生成失败: 启动任务失败"
- 后台任务正常执行
- 最终显示生成的图片

#### ❌ 仍然有问题
- 立即显示 "生成失败: 启动任务失败"
- 请继续查看下面的"高级排查"部分

---

## 高级排查（如果问题仍然存在）

### 1. 检查 Network 请求详情

在开发者工具的 Network 标签中：

1. 找到 **`start_generate`** 请求
2. 点击查看详情
3. 检查以下信息：

#### 请求 URL
```
http://YOUR_SERVER_IP:28888/api/start_generate
```

#### 状态码
- **应该是**: `200 OK`
- **如果是**: `404` → 前端路径配置错误
- **如果是**: `500` → 后端服务错误
- **如果是**: `(failed)` → 网络连接问题

#### 响应内容
**正确的响应应该是：**
```json
{
  "success": true,
  "job_id": "一串随机字符"
}
```

**如果响应是：**
```json
{
  "success": false,
  "error": "..."
}
```
→ 请记录错误信息并联系技术支持

### 2. 检查 Console 错误

在开发者工具的 Console 标签中：
- 查看是否有红色错误信息
- 特别注意 JavaScript 错误或网络错误
- 截图保存以便排查

### 3. 检查 Service Worker

在开发者工具中：
1. 切换到 **Application** 标签（Chrome/Edge）或 **存储** 标签（Firefox）
2. 左侧菜单找到 **Service Workers**
3. 如果有注册的 Service Worker：
   - 点击 **"Unregister"** 或 **"注销"**
   - 刷新页面

### 4. 完全重置浏览器状态

如果以上方法都不行：

1. **清除所有网站数据**
   - Chrome/Edge: 设置 → 隐私和安全 → 清除浏览数据 → 全部时间 → 全选 → 清除
   
2. **重启浏览器**
   - 完全关闭浏览器（包括后台进程）
   - 重新打开

3. **尝试不同的浏览器**
   - 如果 Chrome 有问题，尝试 Firefox
   - 如果 Firefox 有问题，尝试 Edge

---

## 技术支持信息

如果问题仍然存在，请提供以下信息：

### 1. 浏览器信息
- 浏览器名称和版本（例如: Chrome 120.0.6099.109）
- 操作系统（例如: Windows 11, macOS 14, Ubuntu 22.04）

### 2. Network 请求详情
在开发者工具 Network 标签中，找到 `start_generate` 请求：
- 截图请求的 Headers 标签
- 截图请求的 Response 标签
- 记录状态码和响应时间

### 3. Console 错误信息
- 截图 Console 标签中的所有错误信息（红色文字）

### 4. 后端日志
服务器管理员可以提供：
```bash
tail -50 logs/app_cloud.log
```

---

## 常见问题 FAQ

### Q1: 为什么需要清除缓存？
**A**: 前端代码已更新，但浏览器可能加载了旧版本的 JavaScript 文件。清除缓存可以强制浏览器下载最新版本。

### Q2: 硬刷新和普通刷新有什么区别？
**A**: 
- **普通刷新** (F5): 可能使用缓存的资源
- **硬刷新** (Ctrl+Shift+R): 强制重新下载所有资源，忽略缓存

### Q3: 为什么隐私模式可以正常工作？
**A**: 隐私模式不使用缓存，每次都是全新的浏览器环境，所以会加载最新的代码。

### Q4: 清除缓存会影响其他网站吗？
**A**: 
- **清除所有缓存**: 会影响所有网站，需要重新登录
- **硬刷新**: 只影响当前页面，不影响其他网站

### Q5: 我已经清除缓存了，但问题仍然存在
**A**: 请按照"高级排查"部分的步骤检查，并提供详细的错误信息。

---

## 部署状态确认

### 后端服务
- ✅ 运行中
- ✅ 端口 28888 监听
- ✅ API 健康检查通过
- ✅ 详细日志已启用

### 前端静态文件
- ✅ 已重新构建（2025-12-09 10:03）
- ✅ 文件已同步
- ✅ 新版本 JS 文件已生成

### 测试结果
- ✅ API 测试通过
- ✅ 任务启动正常
- ✅ 状态轮询正常

---

**最后更新**: 2025-12-09 10:30  
**状态**: ✅ 后端和前端都已修复，等待用户清除浏览器缓存
